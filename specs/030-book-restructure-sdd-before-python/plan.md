# Implementation Plan: Book Restructure - SDD-RI Before Python

**Branch**: `030-book-restructure-sdd-before-python` | **Date**: 2025-01-24 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/030-book-restructure-sdd-before-python/spec.md`

**Note**: This plan generated by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Restructure the AI Native Software Development book to introduce Spec-Driven Development with Reusable Intelligence (SDD-RI) concepts BEFORE Python fundamentals. This aligns with the book's constitutional principle that "specifications are the new syntax."

**Primary Requirement**: Move 3 chapters (31-33) to new positions (13-15, 35), shift 18 Python chapters (+3), rename parts, migrate all assets (21 slides, ~18 image dirs), update 315+ content references, and modify plugin configurations—all while preserving git history.

**Technical Approach**: Sequential git operations (directories first, then assets, then content updates) executed in reverse order to avoid filename conflicts during overlapping numeric ranges (13-30 → 16-33).

## Technical Context

**Language/Version**: Bash 5.x, TypeScript 5.6 (Docusaurus 3.9.2 plugins), Markdown
**Primary Dependencies**: Docusaurus 3.9.2, git 2.x, remark plugins (interactive-python, content-enhancements)
**Storage**: Local file system (book-source/docs/, book-source/static/), git repository
**Testing**: Manual validation (Docusaurus build, browser tests for interactive code), automated grep validation
**Target Platform**: macOS/Linux development environment, GitHub repository
**Project Type**: Documentation infrastructure (book restructuring)
**Performance Goals**: No performance constraints—operation completes in minutes, not seconds
**Constraints**:
- MUST use `git mv` for all operations (preserve history)
- MUST NOT lose any content files (verified via counts before/after)
- MUST update content references atomically (no broken chapter mentions)
- MUST preserve Docusaurus build integrity (no broken links)

**Scale/Scope**:
- 33 existing chapter directories (1-33)
- 33 slide PDFs
- ~30 image directories
- 315+ narrative chapter references in lesson content
- 21 chapters directly affected by renumbering
- 3 new placeholder chapters (15, 34, 36)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Task Type**: Infrastructure/Documentation (NOT educational content creation)

**Constitutional Applicability**: ❌ **DOES NOT APPLY**

**Rationale**: This feature restructures book metadata, directories, and assets. It does NOT create educational content, design lessons, or teach concepts. The constitution (v6.0.1) governs "Educational content governance (book chapters, lessons, exercises)" per its Scope definition.

**Quality Standards Applied Instead**:
- Spec-Driven Development principles (this feature uses SDD workflow itself)
- Git best practices (history preservation, atomic operations)
- Documentation integrity (Docusaurus build validation)
- Automated testing (grep validation, file counts)

**Post-Design Re-Check**: N/A - Constitution does not govern infrastructure work

## Project Structure

### Documentation (this feature)

```text
specs/030-book-restructure-sdd-before-python/
├── spec.md              # Comprehensive specification (28 FRs, 14 SCs, 5-phase migration)
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output: git mv patterns, reverse-order logic, plugin analysis
├── data-model.md        # Phase 1 output: renumbering mappings, asset inventory
├── quickstart.md        # Phase 1 output: safe rollback procedure, validation commands
├── contracts/           # Phase 1 output: pre/post file structure schemas
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
book-source/
├── docs/                        # Chapter directories (main restructuring target)
│   ├── 01-Introducing-AI-Driven-Development/   # Parts 1-3: No change
│   ├── 02-AI-Tool-Landscape/
│   ├── 03-Markdown-Prompt-Context-Engineering/
│   ├── 04-SDD-RI-Fundamentals/                 # NEW Part 4 (was Part 5)
│   │   ├── 13-specification-driven-development-fundamentals/  # Was 31
│   │   ├── 14-youtube-content-workflow-gemini/               # Was 32
│   │   └── 15-ai-product-business-intelligence-capstone/     # NEW placeholder
│   ├── 05-Python-Fundamentals/                 # Was Part 4
│   │   ├── 16-python-uv-package-manager/      # Was 13
│   │   ├── 17-introduction-to-python/         # Was 14
│   │   └── ... (16-33, all shifted +3)
│   └── 06-AI-Product-Leadership/               # NEW Part 6
│       ├── 34-ai-product-development-evaluation-first/  # NEW placeholder
│       ├── 35-ai-orchestra-agent-teams-manager/         # Was 33
│       └── 36-product-engineering-leadership-ai/        # NEW placeholder
│
├── static/
│   ├── slides/                  # Slide PDFs (21 need renaming)
│   │   ├── chapter-13-slides.pdf → chapter-16-slides.pdf
│   │   └── ... (all affected chapters)
│   └── img/                     # Chapter images (~18 dirs need moving)
│       ├── part-4/ → part-5/   # Python images move to new part
│       └── ... (all affected chapters)
│
├── docusaurus.config.ts         # MUST update: /04-Python-Fundamentals/ → /05-Python-Fundamentals/
├── plugins/
│   └── remark-interactive-python/
│       └── index.js             # MUST update: includePaths path

specs/book/
└── chapter-index.md             # Master metadata (84 → 86 chapters)
```

**Structure Decision**: This is a documentation infrastructure project with no new source code. All changes are file system operations (moves, renames) + content updates (YAML, markdown references, config files).

## Complexity Tracking

> **No constitution violations** - Infrastructure work is out of scope for educational content constitution.

| Justification Category | Rationale |
|------------------------|-----------|
| **Operational Complexity** | 5-phase migration with 24 steps required to avoid filename conflicts during overlapping numeric ranges |
| **Reverse-Order Execution** | Essential pattern when source range (13-30) overlaps with target range (16-33)—prevents overwriting files mid-migration |
| **Asset Migration Scope** | 21 slides + ~18 images must stay synchronized with chapter moves to prevent broken references |
| **Content Reference Updates** | 315+ chapter mentions require automated search-and-replace with REVERSE ORDER to prevent double-replacement (e.g., "Chapter 33" must become "35" BEFORE "30" becomes "33") |

## Phase 0: Research & Unknowns

**Objective**: Resolve all NEEDS CLARIFICATION items from Technical Context and document migration patterns.

### Research Tasks

1. **Git History Preservation with `git mv`**
   - **Question**: Does `git mv` preserve full commit history for renamed directories?
   - **Research**: Test `git log --follow` on renamed directory
   - **Expected Finding**: Yes, `git mv` is equivalent to `git add` + `git rm` with history tracking

2. **Reverse-Order Renaming Pattern**
   - **Question**: Why is reverse order essential for overlapping numeric ranges?
   - **Research**: Document conflict scenario (forward order 13→16 succeeds, then 16→19 overwrites)
   - **Expected Finding**: Forward order causes overwrites; reverse order (30→33, 29→32, ..., 13→16) is safe

3. **Docusaurus Sidebar Generation**
   - **Question**: How does Docusaurus autogenerate sidebars from YAML `sidebar_position`?
   - **Research**: Read sidebars.ts (uses `{type: 'autogenerated', dirName: '.'}`)
   - **Expected Finding**: Directory names are decorative; YAML `sidebar_position` determines order

4. **Interactive Python Plugin Path Resolution**
   - **Question**: Does hardcoded `/04-Python-Fundamentals/` path break interactive code for moved chapters?
   - **Research**: Read `remark-interactive-python/index.js` to understand path matching
   - **Expected Finding**: Path filter is exact match—must be updated to `/05-Python-Fundamentals/`

5. **Custom Plugin Chapter Number Extraction**
   - **Question**: Do `og-image-generator` or `structured-data` plugins parse chapter numbers from directory names?
   - **Research**: Read plugin source to check for regex patterns like `/(\d+)-/`
   - **Expected Finding**: Likely safe—modern plugins use frontmatter metadata, not directory parsing

6. **Content Reference Pattern Analysis**
   - **Question**: What patterns exist for "Chapter X" mentions in lesson files?
   - **Research**: Analyze grep results for reference formats ("Chapter 15", "in Chapter 15", "see Chapter 15")
   - **Expected Finding**: Mostly "Chapter NN" format, some variations with prepositions

**Output**: `research.md` with findings, recommendations, and migration sequence confirmation

## Phase 1: Design & Contracts

**Prerequisites**: `research.md` complete with all unknowns resolved

### 1. Data Model: Renumbering Mappings (`data-model.md`)

**Entity: Chapter**
```yaml
ChapterRenumbering:
  chapter_old: integer (1-33)
  chapter_new: integer (1-36, gaps at 15, 34, 36)
  part_old: integer (1-5)
  part_new: integer (1-6)
  directory_old: string (e.g., "31-specification-driven-development-fundamentals")
  directory_new: string (e.g., "13-specification-driven-development-fundamentals")
  status: enum (UNCHANGED, MOVED, PLACEHOLDER_NEW)
```

**Mappings**:
- Chapters 1-12: No change (status=UNCHANGED)
- Chapter 31 → 13 (Part 5→4, status=MOVED)
- Chapter 32 → 14 (Part 5→4, status=MOVED)
- Chapter 15: NEW (Part 4, status=PLACEHOLDER_NEW)
- Chapters 13-30 → 16-33 (Part 4→5, status=MOVED)
- Chapter 34: NEW (Part 6, status=PLACEHOLDER_NEW)
- Chapter 33 → 35 (Part 5→6, status=MOVED)
- Chapter 36: NEW (Part 6, status=PLACEHOLDER_NEW)

**Entity: Asset**
```yaml
AssetRenumbering:
  asset_type: enum (SLIDE_PDF, IMAGE_DIRECTORY, YAML_REFERENCE, MARKDOWN_REFERENCE)
  path_old: string
  path_new: string
  chapter_ref: integer (links to ChapterRenumbering)
```

**Asset Inventory**:
- 21 slide PDFs: `chapter-{13-30,31-33}-slides.pdf` → `chapter-{16-33,13-14,35}-slides.pdf`
- ~18 image directories: `part-4/chapter-{13,15,16,...,30}/` → `part-5/chapter-{16,18,19,...,33}/`
- ~18 image directories: `part-5/chapter-{31,32,33}/` → `part-4/chapter-{13,14}/ + part-6/chapter-35/`
- 21 YAML references: `slides.source` in chapter READMEs
- 315+ markdown references: "Chapter X" text in lesson files

### 2. API Contracts (`contracts/`)

**File Structure Schema** (`contracts/file-structure-schema.json`):

```json
{
  "pre_migration": {
    "part_directories": [
      "01-Introducing-AI-Driven-Development",
      "02-AI-Tool-Landscape",
      "03-Markdown-Prompt-Context-Engineering",
      "04-Python-Fundamentals",
      "05-Spec-Driven-Development"
    ],
    "chapter_count": 33,
    "slide_count": 33,
    "image_dirs_count": 30
  },
  "post_migration": {
    "part_directories": [
      "01-Introducing-AI-Driven-Development",
      "02-AI-Tool-Landscape",
      "03-Markdown-Prompt-Context-Engineering",
      "04-SDD-RI-Fundamentals",
      "05-Python-Fundamentals",
      "06-AI-Product-Leadership"
    ],
    "chapter_count": 36,
    "slide_count": 33,
    "image_dirs_count": 30
  }
}
```

**Validation Contract** (`contracts/validation-rules.json`):

```json
{
  "git_history_preservation": {
    "command": "git log --follow --oneline {file}",
    "expected": "at_least_one_commit"
  },
  "no_content_loss": {
    "command": "find book-source/docs -name '*.md' | wc -l",
    "pre_count": "TBD",
    "post_count": "TBD",
    "assertion": "pre_count == post_count"
  },
  "plugin_path_updated": {
    "command": "grep -r 'includePaths.*04-Python' book-source",
    "expected": "zero_matches"
  },
  "docusaurus_build": {
    "command": "cd book-source && npm run build",
    "expected": "exit_code_0"
  }
}
```

### 3. Quickstart: Rollback Procedure (`quickstart.md`)

**Safe Rollback**:
```bash
# All operations via git mv means reset restores everything
git reset --hard HEAD

# If commit was made but not pushed
git reset --hard HEAD~1

# Verify restoration
ls -la book-source/docs/04-Python-Fundamentals/  # Should exist
ls -la book-source/docs/05-Spec-Driven-Development/  # Should exist
```

**Validation Commands**:
```bash
# Count chapters before/after
find book-source/docs -type d -name "[0-9]*-*" | wc -l

# Count slides before/after
ls -1 book-source/static/slides/*.pdf | wc -l

# Verify plugin paths updated
grep -r "04-Python" book-source/docusaurus.config.ts book-source/plugins/

# Build check
cd book-source && npm run build
```

### 4. Agent Context Update

```bash
# Update AI agent context with new technologies/patterns from this plan
.specify/scripts/bash/update-agent-context.sh claude
```

**Technologies to add**:
- Git mv operations for directory renaming
- Reverse-order renaming patterns for overlapping numeric ranges
- Docusaurus autogenerated sidebars with YAML sidebar_position
- Remark plugin path configuration

## Phase 2: Implementation Sequence (Preview)

**Note**: Detailed tasks generated by `/sp.tasks` command. This is a high-level overview.

### Phase A: Directory Structure Preparation (3 tasks)
1. Rename Part 4 (Python) → Part 5
2. Rename Part 5 (SDD) → Part 4
3. Create Part 6 directory

### Phase B: Chapter Directory Moves (7 tasks)
4. Move chapter 33 → temp location (avoids conflicts)
5-22. Move Python chapters 30→33, 29→32, ..., 13→16 (REVERSE ORDER, 18 operations)
23. Move SDD chapters 31→13, 32→14
24. Move chapter 33 from temp → 35 (final position)

### Phase C: Asset Migration (13 tasks)
25-42. Rename Python slides 30→33, ..., 13→16 (REVERSE ORDER, 18 operations)
43-44. Rename SDD slides 31→13, 32→14
45. Rename AI Orchestra slide 33→35
46-63. Move Python images (REVERSE ORDER, ~15 operations)
64-65. Move SDD images
66. Move AI Orchestra images

### Phase D: Metadata & Content Updates (6 tasks)
67. Update YAML frontmatter (sidebar_position + slides.source) in 21 READMEs
68. Update image markdown references in lesson files
69-70. Update plugin configuration files (docusaurus.config.ts, index.js)
71. Update narrative chapter references (REVERSE ORDER: 33→35, 32→14, 31→13, then Python)
72. Create placeholder READMEs for chapters 15, 34, 36
73. Update chapter-index.md

### Phase E: Validation (5 tasks)
74. Run Docusaurus build
75. Validate git history preservation
76. Verify asset counts
77. Manual browser test (Chapter 16 interactive code)
78. Spot-check chapter references

**Total estimated tasks**: ~78 individual operations

## Implementation Notes

### Critical Success Factors

1. **Reverse-Order Execution**: Essential for both chapter moves AND content reference updates
   - Chapter moves: 30→33 first prevents 16→19 from overwriting the file we just created
   - Content updates: "Chapter 33" → "35" must happen BEFORE "30" → "33" to prevent double-replacement

2. **Atomic Git Operations**: Use `git mv` exclusively
   - Preserves history automatically
   - Enables simple rollback via `git reset --hard`
   - No need for complex git filter-branch operations

3. **Plugin Configuration**: Critical path dependency
   - Interactive Python code WILL BREAK if plugin path not updated
   - Must update BOTH docusaurus.config.ts AND plugin index.js
   - Validate with grep after changes

4. **Content Reference Safety**: 315+ chapter mentions
   - Automated search-and-replace required (too many for manual)
   - Reverse order prevents double-replacement
   - Spot-check validation after automation

### Risk Mitigation

**Risk**: Mid-operation failure leaves repository in inconsistent state
**Mitigation**: Document each phase as atomic git operation; rollback via `git reset --hard`

**Risk**: Plugin path update missed, breaking interactive code
**Mitigation**: SC-012 validation (grep for old paths) + SC-013 manual browser test

**Risk**: Content reference double-replacement (e.g., "Chapter 30" → "33" → "36")
**Mitigation**: Execute replacements in reverse order (33→35 first, then 30→33)

**Risk**: Docusaurus build breaks due to missing assets or broken links
**Mitigation**: Phase E validation step 74 (build check) before considering complete

## Dependencies

**Upstream**:
- Git repository in clean state (no uncommitted changes)
- Node.js + npm installed (for Docusaurus build validation)
- All chapter directories 1-33 exist with content
- chapter-index-NEW.md already created (serves as reference)

**Downstream**:
- Phase 2: Content creation for chapters 15, 34, 36 (placeholder READMEs only in Phase 1)
- Phase 2: Content pivot for Chapter 14 (Python → YouTube/Gemini)
- Phase 2: Update narrative cross-references if new chapters mention old numbers

## Validation Checklist

**Pre-Migration**:
- [ ] Git status clean (no uncommitted changes)
- [ ] Backup chapter-index.md
- [ ] Count *.md files: `find book-source/docs -name '*.md' | wc -l` → Record count
- [ ] Count slide PDFs: `ls -1 book-source/static/slides/*.pdf | wc -l` → Record count

**Post-Migration** (All 14 Success Criteria from spec.md):
- [ ] SC-001: All 3 chapter directories moved (31→13, 32→14, 33→35) with git history
- [ ] SC-002: All 3 placeholder READMEs created (15, 34, 36) with valid YAML
- [ ] SC-003: chapter-index.md shows 86 chapters correctly
- [ ] SC-004: Directory structure validation passes (Part 4: 3 chapters, Part 5: 18, Part 6: 3)
- [ ] SC-005: Zero content files lost (*.md count matches pre-migration)
- [ ] SC-006: Docusaurus build succeeds (exit code 0)
- [ ] SC-007: All moved READMEs have correct sidebar_position
- [ ] SC-008: All 21 slide PDFs renamed with git history
- [ ] SC-009: All ~18 image directories moved with git history
- [ ] SC-010: All YAML slides.source references updated
- [ ] SC-011: All markdown image references updated (no old part- paths remain)
- [ ] SC-012: Interactive Python plugin paths updated (grep returns zero matches)
- [ ] SC-013: Chapter 16 in browser shows interactive code blocks
- [ ] SC-014: Spot-check 5 random chapter references point to correct new numbers

---

**Plan Status**: ✅ Complete
**Next Command**: `/sp.tasks` to generate actionable tasks.md from this plan
**Estimated Implementation Time**: 2-3 hours (mostly automated, ~78 individual file operations)
