# PanaversityFS Configuration
# Copy to .env and update values

# =============================================================================
# Storage Backend (choose one: fs, s3, supabase)
# =============================================================================
PANAVERSITY_STORAGE_BACKEND=fs

# =============================================================================
# Local Filesystem (when STORAGE_BACKEND=fs)
# =============================================================================
PANAVERSITY_STORAGE_ROOT=./data

# =============================================================================
# Cloudflare R2 / AWS S3 (when STORAGE_BACKEND=s3)
# =============================================================================
# PANAVERSITY_S3_BUCKET=your-bucket-name
# PANAVERSITY_S3_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com
# NOTE: Endpoint should NOT include bucket name - OpenDAL adds it automatically
# PANAVERSITY_S3_ACCESS_KEY_ID=your-access-key
# PANAVERSITY_S3_SECRET_ACCESS_KEY=your-secret-key
# PANAVERSITY_S3_REGION=auto

# =============================================================================
# Supabase Storage (when STORAGE_BACKEND=supabase)
# =============================================================================
# PANAVERSITY_SUPABASE_URL=https://your-project.supabase.co
# PANAVERSITY_SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
# PANAVERSITY_SUPABASE_BUCKET=panaversity-books

# =============================================================================
# Server Configuration
# =============================================================================
PANAVERSITY_SERVER_HOST=0.0.0.0
PANAVERSITY_SERVER_PORT=8000

# =============================================================================
# Authentication (Panaversity SSO Integration)
# =============================================================================
# PanaversityFS validates tokens issued by Panaversity SSO (Better Auth).
#
# Supports two authentication methods (both use Authorization header):
# 1. Authorization: Bearer <jwt-token> - for user sessions via OIDC
# 2. Authorization: Bearer <api-key> - for M2M (GitHub Actions, agents)
#    API keys have prefixes: sk_live_, sk_test_, or pana_
#
# Auth is DISABLED by default. Set AUTH_SERVER_URL to enable.

# Panaversity SSO server URL (required to enable auth)
# Development:
# PANAVERSITY_AUTH_SERVER_URL=http://localhost:3001
# Production:
# PANAVERSITY_AUTH_SERVER_URL=https://sso.panaversity.org

# JWKS endpoint path (default: /api/auth/jwks)
# PANAVERSITY_AUTH_JWKS_PATH=/api/auth/jwks

# API key verification endpoint path (default: /api/api-key/verify)
# PANAVERSITY_AUTH_API_KEY_PATH=/api/api-key/verify

# JWKS cache TTL in seconds (default: 3600 = 1 hour)
# Keys rotate every 90 days with 30-day grace period
# PANAVERSITY_JWKS_CACHE_TTL=3600

# Token validation cache TTL in seconds (default: 300 = 5 minutes)
# PANAVERSITY_TOKEN_CACHE_TTL=300

# This server's public URL (for RFC 9728 OAuth metadata)
# PANAVERSITY_RESOURCE_SERVER_URL=https://api.panaversity.com

# =============================================================================
# CDN Configuration
# =============================================================================
# For R2: Use your public bucket URL
# PANAVERSITY_CDN_BASE_URL=https://pub-xxxxx.r2.dev
# For Supabase:
# PANAVERSITY_CDN_BASE_URL=https://your-project.supabase.co/storage/v1/object/public/bucket-name

# =============================================================================
# Asset Upload Configuration
# =============================================================================
# Assets smaller than this use direct upload (default: 10MB)
# PANAVERSITY_MAX_DIRECT_UPLOAD_MB=10

# Maximum asset size allowed (default: 100MB)
# PANAVERSITY_MAX_ASSET_SIZE_MB=100

# Presigned URL validity period in seconds (default: 3600 = 1 hour)
# PANAVERSITY_PRESIGN_EXPIRY_SECONDS=3600

# =============================================================================
# Archive Generation Configuration
# =============================================================================
# Archive generation timeout in seconds (default: 60)
# PANAVERSITY_ARCHIVE_TIMEOUT_SECONDS=60

# =============================================================================
# Database (PostgreSQL production, SQLite dev)
# =============================================================================
# For production (PostgreSQL via Neon, Supabase, RDS):
# PANAVERSITY_DATABASE_URL=postgresql://user:password@host:5432/panaversityfs?sslmode=require
#
# Note: Auto-converts to asyncpg driver and fixes sslmode for asyncpg compatibility.
# All these formats work:
#   postgresql://...          → postgresql+asyncpg://...
#   postgres://...            → postgresql+asyncpg://...
#   ?sslmode=require          → ?ssl=require (asyncpg syntax)

# For development, omit DATABASE_URL to use SQLite at ./panaversity_fs.db

# =============================================================================
# Observability
# =============================================================================
# PANAVERSITY_SENTRY_DSN=https://xxx@sentry.io/xxx
PANAVERSITY_LOG_LEVEL=INFO
